<div class="work-order-form-template dialog-content-wrapper">
  <div class="mat-dialog-container">
    <mat-toolbar matDialogTitle class="mg-accent-bg m-0">
      <div fxFlex fxLayout="row" fxLayoutAlign="space-between center">

        <div fxFlex fxLayout="row" fxLayoutAlign="start center">

          <mat-icon>note_add</mat-icon>
          <span class="title dialog-title">{{dialogTitle}}</span>
          <!-- / DUE DATE -->

          <!-- ATTACHMENT --
          <div class="due-date pl-12" fxFlex="0 1 auto">
            <button mat-icon-button aria-label="Attachment"
              [disabled]="showAttachments || workOrder.statusId === 3 || workOrder.statusId === 4"
              (click)="ShowAttachments()" matTooltip="Attachments">
              <mat-icon>attachment</mat-icon>
            </button>
          </div>
          -- / ATTACHMENT -->

          <!-- CHECKLIST --
          <div class="due-date " fxFlex="0 1 auto">
            <button mat-icon-button class=""
              [disabled]="addCheckList || workOrder.statusId === 3 || workOrder.statusId === 4" (click)="AddChecklist()"
              matTooltip="Checklist">
              <mat-icon>check_box</mat-icon>
            </button>
          </div>
          -- / CHECKLIST -->

          <!-- BILLING INFORMATION --
          <div class="due-date " fxFlex="0 1 auto">
            <button mat-icon-button
              [disabled]="showBillingInformation || workOrder.statusId === 3 || workOrder.statusId === 4"
              (click)="ShowBillingInformation()" matTooltip="Billing Information">
              <mat-icon>credit_card</mat-icon>
            </button>
          </div>
          -- / BILLING INFORMATION -->

          <!-- EXTERNAL NOTIFICATIONS --
          <div class="due-date " fxFlex="0 1 auto">
            <button mat-icon-button class=""
              [disabled]="setExtNotifications || workOrder.statusId === 3 || workOrder.statusId === 4"
              (click)="setExternalNotifications()" matTooltip="Set External Notifications">
              <mat-icon>add_alert</mat-icon>
            </button>
          </div>
          -- / EXTERNAL NOTIFICATIONS  -->

          <!-- NOTES --
          <div class="due-date " fxFlex="0 1 auto">
            <button mat-icon-button class=""
              [disabled]="addNotes || workOrder.statusId === 3 || workOrder.statusId === 4" (click)="AddNotes()"
              matTooltip="Notes">
              <mat-icon>comment</mat-icon>
            </button>
          </div>
          -- / NOTES -->

          <!-- SCHEDULE SETTING --
          <div class="due-date" fxFlex="0 1 auto">
            <button mat-icon-button aria-label="Attachment"
              [disabled]="showScheduleSettings || workOrder.statusId === 3 || workOrder.statusId === 4"
              (click)="ShowScheduleSettings()" matTooltip="Schedule Settings">
              <mat-icon>calendar_today</mat-icon>
            </button>
          </div>
          -- / SCHEDULE SETTING -->
        </div>

        <!-- CLOSE DIALOG BUTTON -->
        <button mat-icon-button aria-label="Close Dialog" (click)="closeDialog()" *ngIf="showCloseButton">
          <mat-icon>close</mat-icon>
        </button>
        <!-- / CLOSE DIALOG BUTTON -->
      </div>
    </mat-toolbar>

    <div mat-dialog-content class="p-24 m-0" fusePerfectScrollbar>
      <form [formGroup]="workOrderForm">
        <div class="sections">

          <!-- Title and Due Date Section -->
          <div class="section section-request mb-12">

            <div class="section-header number-work-order" fxLayout="row" fxLayoutAlign="start start">
              <div fxFlex="50">
                <mat-icon class="s-20">assignment</mat-icon>
                <span *ngIf="action === 'edit' && !workOrder.originWorkOrderId" fxFlex class="section-title">
                  Request: {{ workOrder.number }}</span>

                <span *ngIf="action === 'edit' && workOrder.originWorkOrderId" fxFlex class="section-title">
                  Request: {{ workOrder.clonePath }}</span>

                <span *ngIf="action !== 'edit'" fxFlex class="section-title">Request</span>
              </div>

              <div fxFlex="50" *ngIf="action !== 'edit' && workOrderfromClone">
                <mat-slide-toggle formControlName="keepCloningReference" class="pr-12">Keep reference to Work Order
                  number: {{workOrder.originWorkOrderNumber}}
                </mat-slide-toggle>
              </div>
            </div>

            <div fxLayout.gt-sm="row" fxLayoutAlign.gt-sm="start center" fxLayout="column"
              fxLayoutAlign="space-around center" fxLayoutGap="16px">

              <!-- Source -->
              <mat-form-field fxFlex="33" fxFlexFill>
                <mat-select [disabled]="disableSourceControl" placeholder="Source" formControlName="sourceCode" required>
                  <mat-option *ngFor="let source of woSources" [value]="source.code">
                    {{source.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <!-- / End Source -->
              
              <!-- WO Type -->
              <mat-form-field fxFlex="33" fxFlexFill>
                <mat-select #sWoType placeholder="Type" formControlName="type"
                  (selectionChange)="woTypeChanged(sWoType.value)">
                  <mat-option *ngFor="let type of workOrderTypes" [value]="type.key">
                    {{type.value}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <!-- / End WO Type -->

              <!-- Priority -->
              <mat-form-field fxFlex="33" fxFlexFill>
                <mat-select placeholder="Priority" formControlName="priority">
                  <mat-option *ngFor="let priority of workOdersPriorities" [value]="priority.id">
                    {{priority.name}}
                  </mat-option>
                </mat-select>
              </mat-form-field>
              <!-- / End Priority -->

              <!-- Due Date -->
              <div fxFlex="33" fxLayout="row" fxFlexFill
                *ngIf="(action==='edit' || action==='editFromPreCalendar') || (!showSnoozeDate && !fromCalendar && selectedScheduleFrequency===7)">
                <mat-form-field>
                  <input matInput placeholder="Due Date" formControlName="dueDate" [owlDateTimeTrigger]="dt"
                    [owlDateTime]="dt">
                  <owl-date-time hour12Timer="true" #dt></owl-date-time>
                  <button mat-button matSuffix mat-icon-button aria-label="Clear" (click)="removeDueDate()">
                    <mat-icon>close</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <!-- / End Due Date  -->

              <!-- SnoozeDate -->
              <div fxFlex="33" fxLayout="row" fxFlexFill *ngIf="showSnoozeDate && !fromCalendar">
                <mat-form-field>
                  <input matInput placeholder="Snooze Date" formControlName="snoozeDate" [owlDateTimeTrigger]="dt"
                    [owlDateTime]="dt">
                  <owl-date-time #dt></owl-date-time>
                </mat-form-field>
              </div>
              <!-- / End SnoozeDate  -->
            </div>

            <div fxLayout.gt-sm="row" fxLayoutAlign.gt-sm="space-between center" fxLayout="column" *ngIf="false"
              fxLayoutAlign="center center">
              <mat-checkbox fxFlex="50" formControlName="defineDate">Define SnoozeDate?</mat-checkbox>
            </div>
          </div>
          <!-- / End Work Order number and Due Date Section -->

          <!-- Category  & subCategory -->
          <div class="section section-request" *ngIf="showCategoryAndSubCategory">
            <!-- Category shceduleSettings -->
            <mat-form-field fxFlex="50" class="mr-24">
              <mat-select #sCategory placeholder="Category" formControlName="scheduleCategoryId"
                (selectionChange)="categoryChanged(sCategory.value)">
                <mat-option *ngFor="let woType of scheduleCategories" [value]="woType.id">
                  {{woType.description}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <!-- / End  Category shceduleSettings -->

            <!-- SubCategory shceduleSettings -->
            <mat-form-field fxFlex="50" class="mr-24">
              <mat-select placeholder="Sub-Category" formControlName="scheduleSubCategoryId">
                <mat-option *ngFor="let woType of scheduleSubCategories" [value]="woType.id">
                  {{woType.name}}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <!-- / End SubCategory shceduleSettings -->
          </div>
          <!-- END  Category  & subCategory  -->

          <!-- Building -->
          <div fxLayout="row" fxLayoutAlign="space-between center" fxLayout="column" fxFlexFill>
            <div class="dates" fxFlexFill fxLayout="column" fxLayout.gt-xs="row">

              <div fxFlex="75" fxLayout="column">
                <mat-form-field class="mr-sm-24" fxFlex>
                  <mat-select placeholder="Buildings" formControlName="buildingId" [(ngModel)]="buildingSelected"
                    required>
                    <mat-option>
                      <ngx-mat-select-search formControlName="buildingCtrl" placeholderLabel="Search"
                        noEntriesFoundLabel="No results"></ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let building of filteredBuildings$ | async" [value]="building.id">
                      {{building.name +' - '+ building.fullAddress}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <div *ngIf="woStatus== 0" class="fullAddress">Ref: {{ workOrder.fullAddress }}</div>
              </div>
              <!-- / End Building -->

              <!-- Location -->
              <mat-form-field fxFlex="25" fxFlex>
                <input matInput placeholder="Suite/Location" formControlName="location" required>
              </mat-form-field>
              <!-- / End Location -->
            </div>
          </div>

          <!-- Requester -->
          <div fxLayout="row" fxLayoutAlign="space-between center" fxLayout="column" fxFlexFill>
            <div class="dates" fxFlexFill fxLayout="column" fxLayout="row">

              <ng-container>
                <!--Requester FullName-->
                <div fxFlex="50" fxLayout="column">
                  <mat-form-field class="mr-sm-24" fxFlex>
                    <input matInput placeholder="Requester Name" formControlName="requesterFullName" required>
                  </mat-form-field>
                </div>
                <!-- / End Requester FullName -->

                <!-- Requester Email -->
                <mat-form-field fxFlex="50" fxFlex>
                  <input matInput placeholder="Requester Email" formControlName="requesterEmail" required type="email">
                </mat-form-field>
                <!-- / End Email -->
              </ng-container>

              <!-- <ng-container *ngIf="action === 'edit'">

                <div fxFlex="50" fxLayout="column">
                  <mat-form-field class="mr-sm-24" fxFlex>
                    <input matInput placeholder="Requester Name" [value]="workOrder.requesterFullName">
                  </mat-form-field>
                </div>



                <mat-form-field fxFlex="50" fxFlex>
                  <input matInput placeholder="Requester Email" [value]="workOrder.requesterEmail">
                </mat-form-field>

              </ng-container> -->
            </div>
          </div>
          <!-- / End Requested -->

          <!-- Description -->
          <mat-form-field class="" fxFill>
            <textarea matInput name="description" formControlName="description" placeholder="Description" rows="4"
              required>
          </textarea>
          </mat-form-field>
          <!-- / End Description -->

          <!-- Employees -->
          <div class="section">
            <!-- Header -->
            <div class="section-header" fxLayout="row" fxLayoutAlign="start center">
              <mat-icon class="s-20">group</mat-icon>
              <span fxFlex class="section-title">Employees</span>
            </div>
            <!-- Header -->

            <!-- Content -->
            <div fxLayout="row" fxLayoutAlign="space-between start" fxLayoutGab="5px">
              <div fxFlex="49" class="h-160 p-8" fxLayout="column" style="border-bottom: 1px solid rgba(0, 0, 0, 0.12);"
                fusePerfectScrollbar>
                <mat-form-field class=" w-100-p">
                  <mat-select placeholder="Added employees" [(ngModel)]="addedEmployees" [compareWith]="compareFn"
                    [multiple]="true" formControlName="assignedEmployees">
                    <mat-select-trigger>
                      {{addedEmployees.length > 0 ? addedEmployees[0].name : ''}}
                      <span *ngIf="addedEmployees?.length > 1">
                        (+{{addedEmployees.length - 1}} others)
                      </span>
                    </mat-select-trigger>
                    <mat-option *ngFor="let employee of availableEmployees; let i = index" [value]="employee">
                      {{ employee.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <div *ngFor="let employee of addedEmployees">
                  <p class="mt-0">
                    {{employee.name}} ({{employee.roleName}})
                  </p>
                </div>
              </div>

              <div fxFlex="49" class="h-160 p-8" fxLayout="column" style="border-bottom: 1px solid rgba(0, 0, 0, 0.12);"
                fusePerfectScrollbar>
                <h4 class="mt-0 mb-4 secondary-text">From building</h4>
                <div *ngFor="let employee of buildingEmployees">
                  <p class="mt-0">
                    {{employee.name}} ({{employee.roleName}})
                  </p>
                </div>
              </div>
            </div>
            <!-- Content -->
          </div>
          <!-- Employees -->

          <!-- Attachment Section -->
          <!-- <div *ngIf="showAttachments" class="section section-request"> -->
          <div class="section section-request">

            <div class="attachments">

              <div class="section-header" fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="s-20">attachment</mat-icon>
                <span fxFlex class="section-title">Attachments</span>
              </div>

              <div class="">

                <div class="attachment" formArrayName="attachments"
                  *ngFor="let item of attachments.controls; let i = index; let lst = last; let fst = first;">
                  <div [formGroupName]="i" fxFlex fxLayout="row" fxLayoutAlign="start center">

                    <div fxLayout.gt-xs="row" fxLayoutAlign.gt-xs="start center" fxLayout="column"
                      fxLayoutAlign="center start">

                      <div class="attachment-preview mat-elevation-z2"
                        [ngStyle]="{'background-image': 'url('+this.attachments.at(i).get('fullUrl').value+')'}"
                        (click)="open(i)">

                      </div>

                      <div class="attachment-content" fxLayout="column">

                        <div fxLayout="row" fxLayoutAlign="start center">
                          <mat-form-field fxFill>
                            <input matInput type="text" placeholder="Image Description" formControlName="description">
                          </mat-form-field>
                          <!-- <span class="attachment-name">{{ this.attachments.at(i).get('description').value }}</span> -->
                        </div>
                        <!-- <span class="attachment-time">{{ this.attachments.at(i).get('imageTakenDate').value }}</span> -->

                        <div>
                          <button mat-button class="add-attachment-button" aria-label="remove attachment"
                            (click)="removeAttachment(i)"
                            [disabled]="workOrder.statusId === 3 || workOrder.statusId === 4">
                            Remove Attachment
                          </button>
                        </div>

                      </div>
                    </div>

                    <!-- <div *ngSwitchCase="'link'" fxLayout="row">
                      <div class="attachment-preview mat-elevation-z2" fxLayout="column" fxLayoutAlign="center center">
                        <span>LINK</span>
                      </div>
                      <div class="attachment-content" fxLayout="column">
                        <span class="attachment-url">{{item.fullUrl}}</span>
                        <span class="attachment-time">{{item.imageTakenDate}}</span>
                      </div>
                    </div> -->
                  </div>
                </div>
                <button mat-button class="add-attachment-button" aria-label="add attachment" (click)="openInputFile()"
                  [disabled]="workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                  <div fxLayout="row" fxLayoutAlign="start center">
                    <mat-icon class="s-20">add</mat-icon>
                    <span>Add an attachment</span>
                  </div>
                </button>
                <input id="fileInput" hidden type="file" multiple accept="image/*"
                  (change)="fileChange($event.target.files)">

              </div>

            </div>

          </div>
          <!-- / End Attachment Section -->

          <!-- Tasks Section -->
          <!-- <div *ngIf="addCheckList"> -->
          <div>
            <div class="section">
              <div class="checklist">
                <div class="section-header mb-0" fxLayout="row" fxLayoutAlign="start center">

                  <mat-icon class="s-20">check_box</mat-icon>

                  <span fxFlex class="section-title">Task List</span>

                  <div fxLayout="row">
                    <button mat-menu-item (click)="newTask(true)">
                      <mat-icon>attach_money</mat-icon>
                    </button>

                    <button mat-menu-item (click)="newTask(false)">
                      <mat-icon>money_off</mat-icon>
                    </button>
                    <!-- <button mat-icon-button class="checklist-actions-button" [matMenuTriggerFor]="checklistActionsMenu">
                      <mat-icon class="s-20">more_vert</mat-icon>
                    </button>
                    <mat-menu #checklistActionsMenu="matMenu">
                      <button mat-menu-item (click)="newTask()">
                        <mat-icon>note_add</mat-icon>
                        <span>Add Task</span>
                      </button>
                      <button mat-menu-item (click)="removeChecklist()" id="remove-checklist-bt"
                        [disabled]="roleLevelLoggedUser >= 30 || workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                        <mat-icon>delete</mat-icon>
                        <span>Remove Checklist</span>
                      </button>
                    </mat-menu> -->
                  </div>
                </div>

                <div class="section-content pt-0">

                  <div class="checklist-progress" fxLayout="row" fxLayoutAlign="start center">

                    <span class="checklist-progress-value">
                      {{ countTasksCheck() }} / {{ tasks.length}}
                    </span>

                    <mat-progress-bar class="mat-primary checklist-progressbar" mode="determinate"
                      value="{{100 * countTasksCheck() / tasks.length}}">
                    </mat-progress-bar>
                  </div>

                  <!-- List of Tasks -->
                  <div class="check-items">

                    <div formArrayName="tasks"
                      *ngFor="let item of tasks.controls; let i = index; let lst = last; let fst = first;"
                      class="check-item" fxLayout="row" fxLayoutAlign="space-between center">

                      <div [formGroupName]="i" fxFlex fxLayout="row" fxLayoutAlign="start center">
                        <mat-checkbox formControlName="isComplete" (ngModelChange)="updateTaskCheck(i, $event)">
                        </mat-checkbox>
                        <mat-form-field fxFlex class="mx-12">
                          <input formControlName="description" matInput name="description" autocomplete="off">
                        </mat-form-field>
                      </div>

                      <ng-container *ngIf="roleLevelLoggedUser < 30">
                        <table *ngIf="woTasks[i].workOrderServiceId" fxFlex="35" class="line-height-2 mat-caption">
                          <tbody>
                            <tr>
                              <td>
                                {{woTasks[i].serviceName}}
                              </td>
                              <td class="text-align">
                                {{(woTasks[i].rate * woTasks[i].quantity) | currency:'USD':'symbol'}}
                              </td>
                            </tr>
                          </tbody>
                        </table>
                        <button mat-button class="mat-icon-button" matTooltip="Update Task" (click)="updateTask(i)"
                          [disabled]="workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                          <mat-icon>edit</mat-icon>
                        </button>
                        <!-- <button mat-button class="mat-icon-button" aria-label="Billing Task" matTooltip="Billing Task"
                          (click)="addTaskBilling(i)"
                          [disabled]="workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                          <mat-icon>local_atm</mat-icon>
                        </button> -->
                        <button mat-button class="mat-icon-button" aria-label="Delete" matTooltip="Delete"
                          (click)="deleteTask(i)"
                          [disabled]="workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                          <mat-icon>delete</mat-icon>
                        </button>
                      </ng-container>
                    </div>

                    <!--
                    <div class="check-item" fxLayout="row" fxLayoutAlign="space-between center">
                      <div fxFlex fxLayout="row" fxLayoutAlign="start center">
                        <mat-icon class="s-20">add</mat-icon>
                        <mat-form-field fxFlex class="mx-12">
                          <input matInput name="description" placeholder="Add a task" autocomplete="off"
                            [(ngModel)]="taskDescription" [ngModelOptions]="{standalone: true}">
                        </mat-form-field>
                      </div>
                      <button mat-raised-button class="mat-accent" aria-label="Add" (click)="addTask(taskDescription)"
                        [disabled]="isDisabled(taskDescription) || workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                        <span>Add</span>
                      </button>
                    </div>-->
                  </div>
                  <!-- End List of Tasks-->

                </div>
              </div>
            </div>
          </div>
          <!-- / End Tasks Section -->

          <!-- Billing Information Section -->
          <!-- <div *ngIf="showBillingInformation && roleLevelLoggedUser < 30" class="section section-request"> -->
          <div *ngIf="roleLevelLoggedUser < 30" class="section section-request">

            <div class="attachments">

              <div class="section-header" fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="s-20">credit_card</mat-icon>
                <span fxFlex class="section-title">Bill to</span>
              </div>

              <div fxLayout="row" fxLayoutAlign="start center" fxFlexFill>
                <mat-form-field class="mr-sm-24" fxFlex="33">
                  <mat-icon matPrefix class="mr-12 s-20 secondary-text">account_circle</mat-icon>
                  <input matInput formControlName="billingName" placeholder="Full Name">
                </mat-form-field>

                <mat-form-field class="mr-sm-24" fxFlex="33">
                  <mat-icon matPrefix class="mr-12 s-20 secondary-text">email</mat-icon>
                  <input matInput type="email" formControlName="billingEmail" placeholder="Email">
                </mat-form-field>

                <!-- select Date Type -->
                <mat-form-field class="mr-sm-24" fxFlex="33">
                  <mat-select placeholder="Billing Date Type" formControlName="billingDateType">
                    <mat-option *ngFor="let woType of workBillingType" [value]="woType.key">
                      {{woType.value}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <!-- / End select Date Type  -->
              </div>

              <div fxLayout="row" fxLayoutAlign="start center" fxFlexFill>
                <mat-form-field class="" fxFill>
                  <textarea matInput formControlName="billingNote" placeholder="Note to billing" rows="2">
                </textarea>
                </mat-form-field>
              </div>
            </div>
          </div>
          <!-- End Billing Information Section -->

          <!--Schedule Settings Section -->
          <!-- <div *ngIf="showScheduleSettings && roleLevelLoggedUser < 30" class="section section-request"> -->
          <div *ngIf="roleLevelLoggedUser < 30" class="section section-request">
            <div class="attachments">
              <div class="section-header" fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="s-20">calendar_today</mat-icon>
                <span fxFlex class="section-title">Schedule Settings </span>
              </div>
              <div fxLayout="row" fxLayoutAlign="space-between start"
                *ngIf="action==='new' || action==='newFromTicket'">
                <mat-form-field fxFlex="30">
                  <mat-select placeholder="Frequency" [(value)]="selectedScheduleFrequency"
                    (selectionChange)="scheduleFrequencyChanged($event)">
                    <mat-option *ngFor="let frequency of scheduleFrequency" [value]="frequency.id">
                      {{ frequency.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <div fxFlex="68">
                  <!-- DAILY -->
                  <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="8px"
                    *ngIf="selectedScheduleFrequency!=1 && selectedScheduleFrequency!=2 && selectedScheduleFrequency<6">
                    <div fxLayout="column" fxFlex="40">
                      <mat-form-field>
                        <input matInput [matDatepicker]="pDailyStartDate" placeholder="Start date" required
                          [value]="scheduleStartDate" (dateChange)="scheduleStartDateChanged($event)">
                        <mat-datepicker-toggle matSuffix [for]="pDailyStartDate"></mat-datepicker-toggle>
                        <mat-datepicker #pDailyStartDate></mat-datepicker>
                      </mat-form-field>

                      <mat-form-field>
                        <input matInput [matDatepicker]="pDailyEndDate" placeholder="End date" required
                          [value]="scheduleEndDate" (dateChange)="scheduleEndDateChanged($event)">
                        <mat-datepicker-toggle matSuffix [for]="pDailyEndDate"></mat-datepicker-toggle>
                        <mat-datepicker #pDailyEndDate></mat-datepicker>
                      </mat-form-field>

                      <mat-form-field fxFlex="30" *ngIf="selectedScheduleFrequency>1 && selectedScheduleFrequency<6">
                        <input matInput placeholder="Quantity" [formControl]="scheduleQuantityCtrl">
                      </mat-form-field>
                    </div>
                    <div fxFlex fxLayout="column" *ngIf="selectedScheduleFrequency>2 && selectedScheduleFrequency<6">
                      <mat-form-field>
                        <button mat-button matPrefix mat-icon-button aria-label="Clear"
                          (click)="revoveScheduleDateFrequency()">
                          <mat-icon>close</mat-icon>
                        </button>
                        <input matInput [matDatepicker]="pScheduleDate" placeholder="Schedule date"
                          [value]="scheduleDate" (dateChange)="scheduleDateChanged($event)">
                        <mat-datepicker-toggle matSuffix [for]="pScheduleDate"></mat-datepicker-toggle>
                        <mat-datepicker #pScheduleDate></mat-datepicker>
                      </mat-form-field>

                      <div class="h-140" fusePerfectScrollbar>
                        <span>Scheduled Dates:</span>
                        <div fxLayout="row" fxLayoutAlign="start center"
                          *ngFor="let sdate of scheduleDates; let i = index">
                          <button mat-icon-button (click)="removeScheduleDate(i)" [disabled]="i===0"
                            [ngClass]="{'primary-50-fg':i===0}">
                            <mat-icon>delete</mat-icon>
                          </button>
                          <span>
                            {{sdate | date:'MMMM y'}}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- END DAILY -->

                  <!-- WEEKLY -->
                  <div *ngIf="selectedScheduleFrequency===1" fxLayout="row" fxLayoutAlign="start start">
                    <div fxLayout="column">
                      <mat-form-field fxFlex="40">
                        <input matInput [matDatepicker]="pWeeklyStartDate" placeholder="Start date" required
                          [value]="scheduleStartDate" (dateChange)="scheduleStartDateChanged($event)">
                        <mat-datepicker-toggle matSuffix [for]="pWeeklyStartDate"></mat-datepicker-toggle>
                        <mat-datepicker #pWeeklyStartDate></mat-datepicker>
                      </mat-form-field>

                      <mat-form-field>
                        <input matInput [matDatepicker]="pWeeklyEndDate" placeholder="End date" required
                          [value]="scheduleEndDate" (dateChange)="scheduleEndDateChanged($event)">
                        <mat-datepicker-toggle matSuffix [for]="pWeeklyEndDate"></mat-datepicker-toggle>
                        <mat-datepicker #pWeeklyEndDate></mat-datepicker>
                      </mat-form-field>

                      <mat-form-field>
                        <input matInput placeholder="Quantity" [formControl]="scheduleQuantityCtrl">
                      </mat-form-field>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayout="row wrap" class="ml-8">
                      <div *ngFor="let day of scheduleDays" fxFlex="50">
                        <mat-checkbox class="font-size-12 mr-4" [checked]="day.isSelected"
                          (change)="checkDay($event, day.id)">
                          {{day.name}}
                        </mat-checkbox>
                      </div>
                    </div>
                  </div>
                  <!-- END WEEKLY -->

                  <!-- MONTHLY -->
                  <div *ngIf="selectedScheduleFrequency===2" fxLayout="row" fxLayoutAlign="start start">
                    <div fxLayout="column" fxFlex="40">
                      <mat-form-field>
                        <mat-select placeholder=" " [(value)]="selectedScheduleOrdinal">
                          <mat-option *ngFor="let ordinal of scheduleOrdinal" [value]="ordinal.id">
                            {{ ordinal.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>

                      <mat-form-field>
                        <mat-select placeholder="Start Month" [(value)]="scheduleStartMonth">
                          <mat-option *ngFor="let month of scheduleMonths" [value]="month.id">
                            {{ month.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>

                      <mat-form-field>
                        <mat-select placeholder="End Month" [(value)]="scheduleEndMonth">
                          <mat-option *ngFor="let month of scheduleMonths" [value]="month.id">
                            {{ month.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                    </div>

                    <div fxLayout="row" fxLayoutAlign="space-between start" fxLayout="row wrap" class="ml-8">
                      <div *ngFor="let day of scheduleDays" fxFlex="50">
                        <mat-checkbox class="font-size-12 mr-4" [checked]="day.isSelected"
                          (change)="checkDay($event, day.id)">
                          {{day.name}}
                        </mat-checkbox>
                      </div>
                    </div>
                  </div>
                  <!-- END MONTHLY -->

                  <!-- QUARTERLY --
                  <div *ngIf="selectedScheduleFrequency===3" fxLayout="row" fxLayoutAlign="space-between center">
                    <mat-form-field fxFlex="30">
                      <mat-select placeholder="Month" [(value)]="selectedScheduleMonth">
                        <mat-option *ngFor="let month of scheduleMonths" [value]="month.id">
                          {{ month.name }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput placeholder="Start Year" [value]="scheduleStartYear">
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput [matDatepicker]="pQuarterlyScheduleDate" placeholder="Schedule date"
                        [value]="scheduleDate">
                      <mat-datepicker-toggle matSuffix [for]="pQuarterlyScheduleDate"></mat-datepicker-toggle>
                      <mat-datepicker #pQuarterlyScheduleDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  -- END QUARTERLY -->

                  <!-- SEMI ANUALLY --
                  <div *ngIf="selectedScheduleFrequency===4" fxLayout="row" fxLayoutAlign="space-between center">
                    <mat-form-field fxFlex="30">
                      <mat-select placeholder="Month" [(value)]="selectedScheduleMonth">
                        <mat-option *ngFor="let month of scheduleMonths" [value]="month.id">
                          {{ month.name }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput placeholder="Start Year" [value]="scheduleStartYear">
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput [matDatepicker]="pSemiAnuallyScheduleDate" placeholder="Schedule date"
                        [value]="scheduleDate">
                      <mat-datepicker-toggle matSuffix [for]="pSemiAnuallyScheduleDate"></mat-datepicker-toggle>
                      <mat-datepicker #pSemiAnuallyScheduleDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  -- END SEMI ANUALLY -->

                  <!-- ANUALLY --
                  <div *ngIf="selectedScheduleFrequency===5" fxLayout="row" fxLayoutAlign="space-between center">
                    <mat-form-field fxFlex="30">
                      <mat-select placeholder="Month" [(value)]="selectedScheduleMonth">
                        <mat-option *ngFor="let month of scheduleMonths" [value]="month.id">
                          {{ month.name }}
                        </mat-option>
                      </mat-select>
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput placeholder="Start Year" [value]="scheduleStartYear">
                    </mat-form-field>

                    <mat-form-field fxFlex="30">
                      <input matInput [matDatepicker]="pAnuallyScheduleDate" placeholder="Schedule date"
                        [value]="scheduleDate">
                      <mat-datepicker-toggle matSuffix [for]="pAnuallyScheduleDate"></mat-datepicker-toggle>
                      <mat-datepicker #pAnuallyScheduleDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  -- END ANUALLY -->

                  <!-- NOT REPEAT -->
                  <div *ngIf="selectedScheduleFrequency===6" fxLayout="row" fxLayoutAlign="start center">
                    <mat-form-field>
                      <input matInput [matDatepicker]="pNotRepeatDate" placeholder="Schedule date"
                        (dateChange)="scheduleDateChanged($event)">
                      <mat-datepicker-toggle matSuffix [for]="pNotRepeatDate"></mat-datepicker-toggle>
                      <mat-datepicker #pNotRepeatDate></mat-datepicker>
                    </mat-form-field>
                  </div>
                  <!-- END NOT REPEAT -->

                  <!-- CUSTOM -->
                  <div *ngIf="selectedScheduleFrequency===7" fxLayout="row" fxLayoutAlign="start center">

                  </div>
                  <!-- END CUSTOM -->
                </div>
              </div>

              <div fxLayout="row" fxLayoutAlign="start center">
                <mat-form-field *ngIf="unscheduledStatus && action === 'edit'">
                  <input matInput [matDatepicker]="pUnscheduledDate" placeholder="Schedule date"
                    (dateChange)="scheduleUpdateDateChanged($event)">
                  <mat-datepicker-toggle matSuffix [for]="pUnscheduledDate"></mat-datepicker-toggle>
                  <mat-datepicker #pUnscheduledDate></mat-datepicker>
                </mat-form-field>

                <!-- Schedule Date -->
                <div fxLayout="row"
                  *ngIf="!showSnoozeDate && !fromCalendar && !unscheduledStatus && (action != 'new' && action != 'newFromTicket')">
                  <mat-form-field fxFlexFill>
                    <input matInput placeholder="Schedule Date" formControlName="scheduleDate" [owlDateTimeTrigger]="dt"
                      [owlDateTime]="dt">
                    <owl-date-time #dt></owl-date-time>
                  </mat-form-field>
                </div>
                <!-- / End Schedule Date -->
              </div>

              <mat-slide-toggle *ngIf="action==='new' || action==='newFromTicket'" formControlName="setStatusByStandBy">
                Set all WOs in sequence to Standby
              </mat-slide-toggle>

              <div *ngIf="roleLevelLoggedUser < 30" fxLayout="row" fxLayoutAlign="start center" fxFlexFill>
                <mat-slide-toggle class="pr-12" formControlName="clientApproved">Client Approved
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="scheduleDateConfirmed">Schedule Date Confirmed
                </mat-slide-toggle>
              </div>

            </div>
          </div>
          <!-- End Schedule Settings Section -->

          <!-- Settings Section -->

          <!-- / Settings Section-->


          <!-- Notes section -->
          <!-- <div *ngIf="addNotes" class="section"> -->
          <div class="section">

            <div class="comments">

              <div class="section-header" fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="s-20">comment</mat-icon>
                <span fxFlex class="section-title">Notes</span>
              </div>

              <div name="cardCommentForm" class="comment new-comment" fxLayout="column" fxLayoutAlign="start">
                <div fxLayout="row">
                  <img class="comment-member-avatar" src="assets/images/avatars/profile.jpg">
                  <div fxFlex>
                    <mat-form-field fxFlex>
                      <input name="textNote" matInput placeholder="Write a note.." [(ngModel)]="textNote"
                        [ngModelOptions]="{standalone: true}">
                    </mat-form-field>
                  </div>
                </div>

                <div fxLayout="row" fxLayoutAlign="end center">
                  <button mat-raised-button class="mat-accent" aria-label="Add" (click)="addNote(textNote)"
                    [disabled]="isDisabled(textNote) || workOrder.statusId === 3 || workOrder.statusId === 4 || readOnly">
                    <span>Add Note</span>
                  </button>
                </div>
              </div>

              <div formArrayName="notes"
                *ngFor="let item of notes.controls; let i = index; let lst = last; let fst = first;"
                class="section-content">
                <div [formGroupName]="i">

                  <div class="comment" fxLayout="row" fxLayoutAlign="start">

                    <img class="comment-member-avatar" src="assets/images/avatars/profile.jpg">
                    <div fxLayout="column">
                      <div class="comment-member-name">
                        {{ notes.controls[i].controls.employeeFullName.value }}
                      </div>
                      <div class="comment-bubble">
                        {{ notes.controls[i].controls.note.value }}
                      </div>
                      <div class="comment-time secondary-text">
                        {{ notes.controls[i].controls.epochCreatedDate.value | fromEpoch }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- / Notes section -->

        </div>

      </form>
    </div>

    <div mat-dialog-actions class="m-0 p-16" fxLayout="row" fxLayoutAlign="space-between center" *ngIf="!readOnly">

      <button *ngIf="action !=='edit'" mat-raised-button (click)="submit()" color="accent"
        [disabled]="workOrderForm.invalid || buttonSaveDisabled" aria-label="SAVE">
        SAVE
      </button>

      <button *ngIf="action ==='edit'" mat-raised-button (click)="submit()" color="accent"
        [disabled]="workOrderForm.invalid || workOrder.statusId === 3 || workOrder.statusId === 4" aria-label="SAVE">
        SAVE
      </button>

      <button *ngIf="action ==='edit'" mat-button class="mat-icon-button" (click)="delete()"
        [disabled]="roleLevelLoggedUser >= 30 || workOrder.statusId === 3 || workOrder.statusId === 4"
        aria-label="Delete" matTooltip="Delete">
        <mat-icon>delete</mat-icon>
      </button>

    </div>
  </div>
</div>
